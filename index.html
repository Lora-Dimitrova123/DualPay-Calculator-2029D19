<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>DualPay – Ресто</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@600&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Montserrat', sans-serif;
  background: #fff1f6;
  overflow: hidden;
}
h1, h2, button {
  font-family: 'Comfortaa', cursive;
}
/* Dynamic background symbols full coverage */
#bgSymbols {
  position: fixed;
  inset: 0;
  display: grid;
  grid-template-columns: repeat(8,1fr);
  grid-auto-rows: 6rem;
  pointer-events: none;
}
.bgSymbol {
  opacity: 0.07;
  font-size: 4rem;
  color: #fbcfe8;
  animation: drift 20s infinite ease-in-out;
}
@keyframes drift {
  0% { transform: translate(0,0) rotate(0deg); }
  50% { transform: translate(40px,-30px) rotate(8deg); }
  100% { transform: translate(0,0) rotate(0deg); }
}
</style>
</head>

<body>

<!-- DYNAMIC BACKGROUND -->
<div id="bgSymbols"></div>

<!-- APP FRAME -->
<div class="relative max-w-md mx-auto p-6 space-y-5 z-10">

  <h1 class="text-2xl text-center text-pink-500">DualPay</h1>

  <!-- Price input -->
  <div class="space-y-1">
    <label class="text-sm font-semibold">Дължима сума</label>
    <div class="flex gap-2">
      <input id="price" type="number" class="flex-1 p-3 rounded-xl bg-yellow-100 outline-none" placeholder="0.00">
      <select id="priceCur" class="p-3 rounded-xl">
        <option value="BGN">BGN</option>
        <option value="EUR">EUR</option>
      </select>
    </div>
  </div>

  <!-- Paid -->
  <div class="grid grid-cols-2 gap-2">
    <input id="paidBGN" type="number" class="rounded-xl p-3" placeholder="Платено в лв">
    <input id="paidEUR" type="number" class="rounded-xl p-3" placeholder="Платено в €">
  </div>

  <!-- Calculate button -->
  <button onclick="calculate()" class="w-full py-3 rounded-xl bg-green-300 text-white text-lg shadow">Изчисли ресто</button>

  <!-- Error -->
  <div id="error" class="hidden text-center text-red-700 bg-red-100 p-3 rounded-xl">Недостатъчна сума</div>

  <!-- Result -->
  <div id="result" class="hidden space-y-2 text-center">
    <div class="flex justify-center gap-2">
      <button onclick="setChange('BGN')" class="bg-green-200 px-4 py-1 rounded-full">Върни в лв</button>
      <button onclick="setChange('EUR')" class="bg-green-200 px-4 py-1 rounded-full">Върни в €</button>
    </div>
    <div class="text-xl font-semibold" id="mainRes">0.00</div>
    <div class="text-sm text-gray-500" id="secRes"></div>
  </div>

  <!-- Footer -->
  <footer class="text-xs text-center text-gray-500 pt-4">
    КУРС: 1 EUR = 1.95583 BGN<br>© Лора Димитрова
  </footer>

</div>

<!-- ICON CANVAS -->
<canvas id="icon" width="512" height="512" class="hidden"></canvas>

<script>
// Populate dynamic background
const bg = document.getElementById('bgSymbols');
for(let i=0; i<80; i++){
  const span = document.createElement('span');
  span.className = 'bgSymbol';
  span.textContent = i%2===0 ? '€' : 'лв';
  bg.appendChild(span);
}

// Currency and calculation logic
const rate = 1.95583;
let mode = 'BGN';

function calculate(){
  const price = +document.getElementById('price').value;
  const paidB = +document.getElementById('paidBGN').value;
  const paidE = +document.getElementById('paidEUR').value;
  const cur = document.getElementById('priceCur').value;

  const error = document.getElementById('error');
  const res = document.getElementById('result');

  let priceBGN = cur==='EUR' ? price*rate : price;
  let paidTotal = paidB + paidE*rate;

  if(paidTotal < priceBGN){
    error.classList.remove('hidden');
    res.classList.add('hidden');
    return;
  }
  error.classList.add('hidden');
  res.classList.remove('hidden');

  const changeBGN = paidTotal - priceBGN;
  const changeEUR = changeBGN/rate;
  updateDisplay(changeBGN, changeEUR);
}

function setChange(c){ mode = c; calculate(); }
function updateDisplay(b,e){
  const main = document.getElementById('mainRes');
  const sec = document.getElementById('secRes');
  if(mode==='BGN'){
    main.textContent = b.toFixed(2)+' лв';
    sec.textContent = '('+e.toFixed(2)+' €)';
  } else {
    main.textContent = e.toFixed(2)+' €';
    sec.textContent = '('+b.toFixed(2)+' лв)';
  }
}

// PWA manifest & SW
const canvas = document.getElementById('icon').getContext('2d');
canvas.fillStyle='#86efac';
canvas.fillRect(0,0,512,512);
canvas.fillStyle='#fff';
canvas.font='120px Comfortaa';
canvas.textAlign='center';
canvas.fillText('€⇄лв',256,300);
const iconURL = document.getElementById('icon').toDataURL();

const manifest = {
  name:'DualPay', short_name:'DualPay',
  start_url:'.', display:'standalone',
  background_color:'#fff1f6', theme_color:'#86efac',
  icons:[{src:iconURL,sizes:'512x512',type:'image/png'}]
};
const mBlob = new Blob([JSON.stringify(manifest)],{type:'application/json'});
const mUrl = URL.createObjectURL(mBlob);
const link = document.createElement('link');
link.rel='manifest'; link.href=mUrl;
document.head.appendChild(link);

const swBlob = new Blob([`
self.addEventListener('install',e=>self.skipWaiting());
self.addEventListener('fetch',()=>{});
`],{type:'text/javascript'});
navigator.serviceWorker.register(URL.createObjectURL(swBlob));
</script>

</body>
</html>
